<div class="wysiwyg-editor-wrapper">
  <div class="pages-container">
    <!-- Każda strona A4 -->
    @for (page of pages(); track $index) {
      <div class="page-wrapper">
        <div class="page" 
             [class.landscape]="pageOrientation === 'landscape'"
             [attr.data-page-number]="$index + 1">
          
          <!-- Nagłówek strony -->
          <div class="page-header"
               [class.editing]="editingSection() === 'header'"
               [style.min-height.cm]="headerHeight()"
               [style.padding-left.px]="pageMargins.left * 37.8"
               [style.padding-right.px]="pageMargins.right * 37.8"
               (click)="startEditingHeader()"
               (dblclick)="startEditingHeader()">
            @if (editingSection() === 'header' && $index === 0) {
              <div 
                #headerContent
                class="header-editor-content"
                contenteditable="true"
                spellcheck="true"
                [attr.placeholder]="''"
                (input)="onHeaderInput($event)"
              ></div>
              <!-- Pasek nagłówka w stylu Google Docs -->
              <div class="header-toolbar" (click)="$event.stopPropagation()">
                <span class="header-toolbar-label">Nagłówek</span>
                <div class="header-toolbar-spacer"></div>
                <label class="header-toolbar-checkbox">
                  <input type="checkbox" 
                         [checked]="differentFirstPage()" 
                         (change)="toggleDifferentFirstPage()">
                  <span>Inna pierwsza strona</span>
                </label>
                <div class="header-toolbar-options">
                  <button class="header-options-btn" (click)="toggleHeaderOptionsMenu($event)">
                    Opcje
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M7 10l5 5 5-5z"/>
                    </svg>
                  </button>
                  @if (showHeaderOptionsMenu()) {
                    <div class="header-options-menu" (click)="$event.stopPropagation()">
                      <button class="menu-item" (click)="openHeaderFormatDialog()">
                        Format nagłówka
                      </button>
                      <button class="menu-item" (click)="insertPageNumbers()">
                        Numery stron
                      </button>
                      <button class="menu-item" (click)="removeHeader()">
                        Usuń nagłówek
                      </button>
                    </div>
                  }
                </div>
              </div>
            } @else {
              <div class="header-display" [innerHTML]="getHeaderContent($index)"></div>
            }
          </div>
          
          @if ($index === 0) {
            <div 
              #editorContent
              class="editor-content"
              contenteditable="true"
              spellcheck="true"
              [attr.placeholder]="'Zacznij pisać...'"
              [style.padding-left.px]="pageMargins.left * 37.8"
              [style.padding-right.px]="pageMargins.right * 37.8"
              [style.padding-top.px]="8"
              [style.padding-bottom.px]="8"
              (mouseup)="saveSelection()"
              (keyup)="saveSelection()"
              (click)="stopEditingHeaderFooter()"
            ></div>
          } @else {
            <div class="page-overflow-content"
                 [style.padding-left.px]="pageMargins.left * 37.8"
                 [style.padding-right.px]="pageMargins.right * 37.8"
                 [style.padding-top.px]="8"
                 [style.padding-bottom.px]="8"
                 [innerHTML]="page"
                 (click)="stopEditingHeaderFooter()">
            </div>
          }

          <!-- Stopka strony -->
          <div class="page-footer"
               [class.editing]="editingSection() === 'footer'"
               [style.min-height.cm]="footerHeight()"
               [style.padding-left.px]="pageMargins.left * 37.8"
               [style.padding-right.px]="pageMargins.right * 37.8"
               (click)="startEditingFooter()"
               (dblclick)="startEditingFooter()">
            @if (editingSection() === 'footer' && $index === 0) {
              <!-- Pasek stopki w stylu Google Docs -->
              <div class="footer-toolbar" (click)="$event.stopPropagation()">
                <span class="footer-toolbar-label">Stopka</span>
                <div class="footer-toolbar-spacer"></div>
                <label class="footer-toolbar-checkbox">
                  <input type="checkbox" 
                         [checked]="differentFirstPage()" 
                         (change)="toggleDifferentFirstPage()">
                  <span>Inna pierwsza strona</span>
                </label>
                <div class="footer-toolbar-options">
                  <button class="footer-options-btn" (click)="toggleFooterOptionsMenu($event)">
                    Opcje
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M7 10l5 5 5-5z"/>
                    </svg>
                  </button>
                  @if (showFooterOptionsMenu()) {
                    <div class="footer-options-menu" (click)="$event.stopPropagation()">
                      <button class="menu-item" (click)="openFooterFormatDialog()">
                        Format stopki
                      </button>
                      <button class="menu-item" (click)="insertPageNumbersFooter()">
                        Numery stron
                      </button>
                      <button class="menu-item" (click)="removeFooter()">
                        Usuń stopkę
                      </button>
                    </div>
                  }
                </div>
              </div>
              <div 
                #footerContent
                class="footer-editor-content"
                contenteditable="true"
                spellcheck="true"
                [attr.placeholder]="''"
                (input)="onFooterInput($event)"
              ></div>
            } @else {
              <div class="footer-display" [innerHTML]="getFooterContent($index)"></div>
            }
          </div>
        </div>
        
        <!-- Separator między stronami - styl Google Docs -->
        @if ($index < pages().length - 1) {
          <div class="page-separator"></div>
        }
      </div>
    }
  </div>
</div>